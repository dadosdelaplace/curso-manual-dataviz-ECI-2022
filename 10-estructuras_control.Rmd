```{r echo = FALSE}
library(knitr)

# Color text
colorize <- function(x, color) {
  
  if (knitr::is_latex_output()) {
    
    sprintf("\\textcolor{%s}{%s}", color, x)
    
  } else if (knitr::is_html_output()) {
    
    sprintf("<span style='color: %s;'>%s</span>", color, x)
    
  } else { x }
}
```

# (PART) Estructuras de control {-}

# Estructuras condicionales if-else {#if-else}

:::: {.blackbox data-latex=""}

Scripts usados:

* [**script07.R**](https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script07.R): estructuras if-else.  Ver en <https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script07.R>

::::

Hasta ahora hemos trasteado con datos: hemos empezado desde una celda, para luego construir columnas, para luego juntarlas en algo parecido a una base de datos.

Para poder manejarnos con soltura con dichos datos es importante que conozcamos como se usan las <mark>**expresiones de control m치s t칤picas**</mark>. Una expresi칩n de control ser치 un **conjunto de 칩rdenes** que nos permiten decidir por donde queremos que avance nuestro programa: 쯤u칠 hacemos si sucede A? 쯏 si sucede B?

Si has programado en alg칰n otro lenguaje, estar치s familiarizado/a con elementos como un `if (blabla) {...} else {...}` (que los usaremos a veces) o bucles `for` y `while`. Si es la primera que programas en alg칰n lenguaje, no te preocupes, las empezamos desde cero, empezando por las <mark>**estructuras condicionales**</mark>

* `if (condici칩n) { c칩digo A } else { c칩digo B }`: si `condici칩n` (por ejemplo, `x == 1`) es cierta, se ejecuta `c칩digo A`; si es falsa, se ejecuta `c칩digo B`.

## if {}
 
Una de las estructuras de control m치s famosas de cualquier lenguaje de programaci칩n: SI las condiciones impuestas se cumplen (`TRUE`), ejecuta las 칩rdenes que tengamos dentro del `if {}`. Definamos por ejemplo una variable sencilla, las edades de 8 personas.

```{r}
edades <- c(14, 17, 24, 56, 31, 20, 87, 73)
```

Para comprobar cuales son menores de edades podemos aplicar lo aprendido en temas anteriores, realizando una **comparaci칩n l칩gica**: si es menor de edad, devuelve un `TRUE`; en caso contrario, devuelve un `FALSE`.

```{r}
edades < 18
```

Con las funciones `any()` y `all()` podemos saber si <mark>**todos o alguno de los elementos de un vector cumplen una condici칩n**</mark>.

```{r}
all(edades >= 18) # todos mayores de edad
any(edades < 18) # existe algun menor de edad
```

Con dichos elementos vamos a construir nuestra **primera estructura condicional**: queremos que si existe alg칰n menor de edad, nos imprima un mensaje indic치ndolo.

```{r}
if (any(edades < 18)) { # TRUE si al menos una persona mayor de edad
  
  print("existe alguna persona mayor de edad")
  
}
```

En caso de que no se cumplan las condiciones dentro del `if()` (condiciones que devuelvan un `FALSE`), no suceder치 nada.

```{r}
if (all(edades >= 18)) { # TRUE si TODOS son mayores de edad
  
  print("todas las personas son mayores de edad")
  
}
```

F칤jate que en este caso no hemos obtenido ning칰n mensaje porque la condici칩n `all(edades >= 18)` no es cierta (no son todos mayores de 18 a침os).

## if - else {}

La estructura `if (condicion) { }` puede ser combinada con un `else { }`, de forma que cuando la condici칩n no se cumpla (como en el 칰ltimo ejemplo), se ejecutar치 el c칩digo que haya dentro del `else { }`, permiti칠ndonos decidir que sucede cuando S칈 se cumple y cuando NO se cumple

```{r}
if (all(edades >= 18)) { # TRUE si TODOS son mayores de edad
  
  print("todas las personas son mayores de edad")
  
} else { # si hay alguno menor de edad 
  
  print("existe alguna persona menor de edad")
}
```

Podemos ya complicar un poco el c칩digo con lo que hemos aprendido de temas anteriores: en caso de que haya alguno menor de edad, queremos extraer la edad por pantalla (con `edades[edades < 18]` extraeremos las edades que cumplen la condici칩n de ser menor de edad).

```{r}
if (all(edades >= 18)) { # TRUE si TODOS son mayores de edad
  
  print("todas las personas son mayores de edad")
  
} else { # si hay alguno menor de edad 
  
  print(glue("Existe alguna persona menor de edad. Sus edades son: {edades[edades < 18]}"))
}
```

## if - else anidados

Dicha estructura `if - else` puede <mark>**anidarse**</mark>, de forma que vayamos concatenando dichas estructuras, como en el ejemplo que tenemos debajo. Imagina que queremos realizar una acci칩n si todos fuesen mayores de edad; en caso contrario, pero si todos los menores de edad tienen 16 a침os o m치s, realizar otra acci칩n; en caso contrario, otra acci칩n

```{r}
if (all(edades >= 18)) { # TRUE si TODOS son mayores de edad
  
  print("todas las personas son mayores de edad")
  
} else if (all(edades >= 16)) { # si todos los menores de edad tienen >=16
  
  print("Existe alguna persona menor de edad pero todos con 16 a침os o m치s")
  
} else {
  
  print("Existe alguna persona menor de 16 a침os")

}
```

# ifelse () vectorizado

Esta <mark>**estructura condicional puede ser vectorizada**</mark>, de forma que podamos reunir en una **sola fila un n칰mero elevado de estructuras de comparaci칩n** la funci칩n `ifelse()`, cuyos argumentos de entrada ser치n la condici칩n a evaluar, lo que sucede cuando se cumple y lo que no, que aplicar치 a cada elemento del vector de entrada. Con el ejemplo de las edades, vamos a **dejar el dato ausente si son menores de edad**, y si son mayores de edad se queda como est치.

```{r}
# NA si no cumple la condici칩n, la edad si se cumple.
ifelse(edades >= 18, edades, NA)
```

Todas estas estructuras no solo sirven para datos num칠ricos. Vamos a definir un vector de nombres con algunos ausentes (`NA`), y vamos a sustituir los ausentes por el texto `"nombre_desconocido"` (los que no sean ausentes se quedan como est치n).


```{r}
nombres <- c("Juan", "Mar칤a", NA, NA, "Luc칤a", "Carmen", "Javier",
             NA, "Carlos", NA, "Gregorio", "Paloma")

# Si tiene ausente --> "nombre_desconocido"
# Si no tiene ausente --> nombres originales
nombres <- ifelse(is.na(nombres), "nombre_desconocido", nombres)
nombres
```

Esta funci칩n `ifelse()` es muy util para codificar variables o averiguar cuales cumplen una condici칩n.

## Consejos


**`r colorize("CONSEJOS", "#20935E")`**

&nbsp;

**`r colorize("Rainbow parentheses", "#20935E")`**

Uno de los **errores m치s habituales**, y que seguir치s cometiendo aunque lleves a침os programando, es <mark>**no cerrar un par칠ntesis que has abierto**</mark>, por lo que el programa no sabe si has acabado de llamar a una orden o no. Para ello en las nuevas versiones de `RStudio`, en el men칰 `Tools < Global Options < Code < Display` podemos habilitar la opci칩n `Rainbow Parentheses` que nos escribe cada par de `()` de un color distinto

```{r echo = FALSE, out.width = "70%", fig.align = "center", fig.cap = "Activando Rainbow Parentheses."}
knitr::include_graphics("./img/rainbow-parentheses.jpg")

```

&nbsp;

**`r colorize("Minimiza estructuras de control en el c칩digo", "#20935E")`**

Puedes colapsar las estructuras de control pulsando en la flecha que aparece a la izquierda de ellas en tu script.

&nbsp;



## 游닇 Ejercicios

(haz click en las flechas para ver soluciones)

<details>
  <summary>游닇<strong>Ejercicio 1</strong>: modifica el c칩digo inferior para imprimir un mensaje por pantalla si todos los mam칤feros del conjunto `MASS::mammals` pesan menos de una tonelada (variable `body`).
  
```{r}
peso <- MASS::mammals$body

if (peso[1] == 1000) {
  
  print("Todos los mam칤feros guardados pesan menos de una tonelada")
  
}
  
```
</summary>
  
<!-- toc -->
- Soluci칩n:

```{r}
peso <- MASS::mammals$body

if (all(peso < 1000)) {
  
  print("Todos los mam칤feros guardados pesan menos de una tonelada")
  
}

```

<!-- tocstop -->
</details>

&nbsp;

<details>
  <summary>游닇<strong>Ejercicio 2</strong>: modifica el c칩digo inferior para imprimir un mensaje por pantalla si alguno de los mam칤feros del conjunto `MASS::mammals` pesan menos de una tonelada (variable `body`).
  
```{r}
peso <- MASS::mammals$body

if (peso[1] == 1000) {
  
  print("Alguno de los mam칤feros guardados pesan menos de una tonelada")
  
}
  
```
</summary>
  
<!-- toc -->
- Soluci칩n:

```{r}
peso <- MASS::mammals$body

if (any(peso < 1000)) {
  
  print("Alguno de los mam칤feros guardados pesan menos de una tonelada")
  
}

```

<!-- tocstop -->
</details>

&nbsp;

<details>
  <summary>游닇<strong>Ejercicio 3</strong>: modifica el c칩digo inferior para imprimir un mensaje por pantalla si el tercer mam칤fero del conjunto `MASS::mammals` tiene un cerebro que pesa m치s de 100 gr (variable `brain`).
  
```{r}
peso <- MASS::mammals$body

if (peso[1] == 1000) {
  
  print("El tercer mam칤fero tiene un cerebro que pesa m치s de 100 gr.")
  
}
  
```

</summary>
  
<!-- toc -->
- Soluci칩n:

```{r}
cerebro <- MASS::mammals$brain

if (cerebro[3] > 100) {
  
  print("El tercer mam칤fero tiene un cerebro que pesa m치s de 100 gr.")
  
}

```

No imprime nada porque no cumple la condici칩n.


<!-- tocstop -->
</details>

&nbsp;

<details>
  <summary>游닇<strong>Ejercicio 4</strong>: del paquete `{lubridate}`, la funci칩n `hour()` nos devuelve la hora de una fecha dada, y la funci칩n `now()` nos devuelve fecha y hora del momento actual. Con ambas funciones, y usando `if`, imprime por pantalla  `"buenas noches"` solo a partir de las 21 horas. </summary>
  
<!-- toc -->
- Soluci칩n:

```{r}
# Cargamos librer칤a
library(lubridate)

# Fecha-hora actual
fecha_actual <- now()

# Estructura if
if (hour(fecha_actual) > 21) {
  
  cat("Buenas noches") # print/cat dos formas de imprimir por pantalla
}
```

<!-- tocstop -->
</details>

&nbsp;


<details>
  <summary>游닇<strong>Ejercicio 5</strong>: con las funciones del ejercicio anterior, y usando una estructura `if-else`, imprime por pantalla `"buenos d칤as"` (de 6 a 14 horas), `"buenas tardes"` (de 14 a 21 horas) o `"buenas noches"` (de las 21 a las 6 horas). </summary>
  
<!-- toc -->
- Soluci칩n:

```{r}
# Fecha actual
fecha_actual <- now()

# Estructura if-else
if (hour(fecha_actual) > 6 & hour(fecha_actual) < 14) {
  
  cat("Buenos d칤as")
  
} else if (hour(fecha_actual) > 14 & hour(fecha_actual) < 21) {
  
  cat("Buenas tardes")
  
} else {
  
  cat("Buenas noches")
}
```

<!-- tocstop -->
</details>

&nbsp;


<details>
  <summary>游닇<strong>Ejercicio 6</strong>: realiza el ejercicio anterior pero sin estructura de llaves, de forma concisa con `ifelse()`. Mira la ayuda si la necesitases poniendo `? ifelse`. </summary>
  
<!-- toc -->
- Soluci칩n:

```{r}
# Fecha actual
fecha_actual <- now()

# Estructura if-else
cat(ifelse(hour(fecha_actual) > 6 & hour(fecha_actual) < 14,
           "Buenos d칤as",
           ifelse(hour(fecha_actual) > 14 &
                    hour(fecha_actual) < 21,
                  "Buenas tardes", "Buenas noches")))
  
```

<!-- tocstop -->
</details>

&nbsp;


