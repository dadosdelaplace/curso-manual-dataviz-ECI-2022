<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cap√≠tulo 16 Tidy vs messy data: daticos ordenados | Analizando datos, visualizando informaci√≥n, contando historias</title>
<meta name="author" content="Javier √Ålvarez Li√©bana y Gabriel Valverde Castilla">
<meta name="description" content="Scripts usados: script16.R: tidy data. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script16.R  Tidy datasets are all alike, but every messy dataset is messy in its...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Cap√≠tulo 16 Tidy vs messy data: daticos ordenados | Analizando datos, visualizando informaci√≥n, contando historias">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/logo_R.png">
<meta property="og:description" content="Scripts usados: script16.R: tidy data. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script16.R  Tidy datasets are all alike, but every messy dataset is messy in its...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cap√≠tulo 16 Tidy vs messy data: daticos ordenados | Analizando datos, visualizando informaci√≥n, contando historias">
<meta name="twitter:description" content="Scripts usados: script16.R: tidy data. Ver en https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script16.R  Tidy datasets are all alike, but every messy dataset is messy in its...">
<meta name="twitter:image" content="/img/logo_R.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Sen-0.4.0/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM%20Mono&amp;display=swap" rel="stylesheet">
<link href="libs/_Bitter-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.18/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analizando datos, visualizando informaci√≥n, contando historias</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li class="book-part">Recursos</li>
<li><a class="" href="ejercicios-recopilados.html">üìù Ejercicios recopilados</a></li>
<li><a class="" href="recursos-de-aprendizaje.html">üìö Recursos de aprendizaje</a></li>
<li class="book-part">Toma de contacto</li>
<li><a class="" href="requisitos.html"><span class="header-section-number">1</span> Requisitos</a></li>
<li><a class="" href="instalacion.html"><span class="header-section-number">2</span> Instalaci√≥n</a></li>
<li><a class="" href="que-es-R.html"><span class="header-section-number">3</span> ¬øQu√© es R?</a></li>
<li><a class="" href="primeros-pasos.html"><span class="header-section-number">4</span> Primeros pasos</a></li>
<li class="book-part">Conceptos b√°sicos</li>
<li><a class="" href="tipos-datos.html"><span class="header-section-number">5</span> Tipos de datos</a></li>
<li><a class="" href="vectores.html"><span class="header-section-number">6</span> Vectores</a></li>
<li><a class="" href="operacionesvectores.html"><span class="header-section-number">7</span> Operaciones con vectores</a></li>
<li><a class="" href="datos.html"><span class="header-section-number">8</span> Datos estructurados</a></li>
<li><a class="" href="repaso-1.html"><span class="header-section-number">9</span> Repaso: empezando a trastear con datos</a></li>
<li class="book-part">Haciendo el trabajo m√°s f√°cil</li>
<li><a class="" href="if-else.html"><span class="header-section-number">10</span> Estructuras de control: if-else</a></li>
<li><a class="" href="bucles.html"><span class="header-section-number">11</span> Estructuras de control: bucles</a></li>
<li><a class="" href="proyecto.html"><span class="header-section-number">12</span> Primer proyecto de trabajo</a></li>
<li><a class="" href="funciones.html"><span class="header-section-number">13</span> Funciones</a></li>
<li><a class="" href="listas.html"><span class="header-section-number">14</span> Listas</a></li>
<li class="book-part">Empezando a explorar datos</li>
<li><a class="" href="tibble.html"><span class="header-section-number">15</span> Mejorando los data.frame: datos tibble</a></li>
<li><a class="active" href="tidy.html"><span class="header-section-number">16</span> Tidy vs messy data: daticos ordenados</a></li>
<li><a class="" href="importar-exportar.html"><span class="header-section-number">17</span> Sacando datos de las piedras</a></li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">18</span> Contando los datos: rmarkdown</a></li>
<li class="book-part">Incursi√≥n a tidyverse</li>
<li><a class="" href="tidyverse.html"><span class="header-section-number">19</span> Depuraci√≥n y transformaci√≥n</a></li>
<li><a class="" href="resumenes.html"><span class="header-section-number">20</span> Resumiendo y relacionado datos</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">21</span> Visualizando datos: incursi√≥n a ggplot2</a></li>
<li><a class="" href="bibliograf%C3%ADa.html">Bibliograf√≠a</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/dadosdelaplace/courses-ECI-2022">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidy" class="section level1">
<h1>
<span class="header-section-number">Cap√≠tulo 16</span> Tidy vs messy data: daticos ordenados<a class="anchor" aria-label="anchor" href="#tidy"><i class="fas fa-link"></i></a>
</h1>
<div class="blackbox">
<p>Scripts usados:</p>
<ul>
<li>
<a href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script16.R"><strong>script16.R</strong></a>: tidy data. Ver en <a href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script16.R" class="uri">https://github.com/dadosdelaplace/courses-ECI-2022/blob/main/scripts/script16.R</a>
</li>
</ul>
</div>
<blockquote>
<p>Tidy datasets are all alike, but every messy dataset is messy in its own way (Hadley Wickham, Chief Scientist en RStudio)</p>
</blockquote>
<p>Hasta ahora solo le hemos dado importancia al ¬´qu√©¬ª pero no al <strong>¬´c√≥mo¬ª manejamos los datos</strong>. La <mark><strong>organizaci√≥n de nuestros datos</strong></mark> es fundamental para que su preparaci√≥n y explotaci√≥n sea <strong>lo m√°s eficiente posible</strong>: la limpieza y preprocesamiento puede llevarnos hasta el <strong>80% del tiempo</strong> en nuestro an√°lisis si no se hace forma correcta <span class="citation">(Dasu and Johnson <a href="bibliograf%C3%ADa.html#ref-DasuJohnson03">2003</a>)</span>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:flujo-tidy-data2"></span>
<img src="img/flujo_tidy_data.jpg" alt="Flujo deseable de datos seg√∫n Hadley Wickham, extra√≠da de &lt;https://r4ds.had.co.nz/wrangle-intro.html&gt;" width="60%"><p class="caption">
Imagen/gr√°fica 16.1: Flujo deseable de datos seg√∫n Hadley Wickham, extra√≠da de <a href="https://r4ds.had.co.nz/wrangle-intro.html" class="uri">https://r4ds.had.co.nz/wrangle-intro.html</a>
</p>
</div>
<p>El concepto <mark><strong>tidy data</strong></mark> fue introducido por <strong>Hadley Wickham</strong> <span class="citation">(Wickham <a href="bibliograf%C3%ADa.html#ref-Wickham14">2014</a>)</span> como el <mark><strong>primer paso</strong></mark> del entorno de paquetes que posteriormente se fueron desarrollando bajo el nombre de <a href="https://tidyverse.tidyverse.org">tidyverse</a>. Los conjuntos <em>tidy</em> o <mark><strong>datos ordenados</strong></mark> tienen tres objetivos</p>
<ul>
<li>
<strong>Estandarizaci√≥n</strong> en su estructura.</li>
<li>
<strong>Sencillez</strong> en su manipulaci√≥n.</li>
<li>Listos para ser <strong>modelizados y visualizados</strong>.</li>
</ul>
<p>Para ello, los <mark><strong>datos ordenados</strong></mark> o <em>tidy data</em> deben cumplir:</p>
<ol style="list-style-type: decimal">
<li>Cada <mark><strong>variable en una columna</strong></mark>.</li>
<li>Cada <mark><strong>observaci√≥n/registro/individuo en una fila diferente</strong></mark>.</li>
<li>Cada <mark><strong>celda con un √∫nico valor</strong></mark>.</li>
<li>Cada <mark><strong>conjunto o unidad observacional conforma una tabla</strong></mark>.</li>
<li>Si contamos con <strong>m√∫ltiples tablas</strong>, debemos tener una <strong>columna com√∫n</strong> en cada una que nos permita <strong>cruzarlas</strong>.</li>
</ol>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tidy-data"></span>
<img src="img/tidy_data.png" alt="Infograf√≠a con datos ordenados (tidy data) extra√≠da de &lt;https://r4ds.had.co.nz/tidy-data.html&gt;" width="80%"><p class="caption">
Imagen/gr√°fica 16.2: Infograf√≠a con datos ordenados (tidy data) extra√≠da de <a href="https://r4ds.had.co.nz/tidy-data.html" class="uri">https://r4ds.had.co.nz/tidy-data.html</a>
</p>
</div>
<p>Lo contrario lo llamaremos <mark><strong>datos desordenados</strong></mark> o <em>messy data</em>.</p>
<div id="entorno-tidyverse" class="section level2">
<h2>
<span class="header-section-number">16.1</span> Entorno tidyverse<a class="anchor" aria-label="anchor" href="#entorno-tidyverse"><i class="fas fa-link"></i></a>
</h2>
<p>Conocemos ya un <mark><strong>formato amable</strong></mark> de almacenar los datos como son los <code>data.frame</code> de tipo <code>tibble</code>. Sin embargo muchas veces los datos no los tenemos en el formato deseado, o directamente queremos realizar algunas <mark><strong>transformaciones</strong></mark> en los mismos, ordenarlos, crear nuevas variables u obtener res√∫menes num√©ricos. Para trabajar con los datos vamos a cargar <a href="https://tidyverse.tidyverse.org">tidyverse</a>, un entorno de paquetes para el manejo de datos (ver m√°s detalles en <a href="tidyverse.html#tidyverse">Transformando los datos: incursi√≥n al universo tidyverse</a>).</p>
<div class="sourceCode" id="cb1365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span> <span class="co"># SOLO la primera vez</span></code></pre></div>
<div class="sourceCode" id="cb1366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:flujo-tidyverse-1"></span>
<a href="https://sporella.github.io/datos_espaciales_presentacion/#30" target="_blank"><img src="img/flujo_tidyverse.png" alt="Imagen extra√≠da de &lt;https://sporella.github.io/datos_espaciales_presentacion/#30&gt;" width="70%"></a>
<p class="caption">
Imagen/gr√°fica 16.3: Imagen extra√≠da de <a href="https://sporella.github.io/datos_espaciales_presentacion/#30" class="uri">https://sporella.github.io/datos_espaciales_presentacion/#30</a>
</p>
</div>
<p>El <mark><strong>entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a></strong></mark> es una de las <strong>herramientas m√°s importantes en el manejo de datos en <code>R</code></strong>, una <strong>colecci√≥n de paquetes</strong> pensada para el manejo, la exploraci√≥n, el an√°lisis y la visualizaci√≥n de datos, compartiendo una <strong>misma filosof√≠a y gram√°tica</strong>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:flujo-tidyverse-2"></span>
<a href="https://www.storybench.org/getting-started-with-tidyverse-in-r/" target="_blank"><img src="img/flujo_tidyverse_1.png" alt="Imagen extra√≠da de &lt;https://www.storybench.org/getting-started-with-tidyverse-in-r/&gt;" width="90%"></a>
<p class="caption">
Imagen/gr√°fica 16.4: Imagen extra√≠da de <a href="https://www.storybench.org/getting-started-with-tidyverse-in-r/" class="uri">https://www.storybench.org/getting-started-with-tidyverse-in-r/</a>
</p>
</div>
<ul>
<li><p><a href="https://tidyr.tidyverse.org">tidyr</a>: para adecuar los datos a <em>tidy data</em></p></li>
<li><p><a href="https://tibble.tidyverse.org/">tibble</a>: mejorando los <code>data.frame</code> para un manejo m√°s</p></li>
<li><p>Paquete <a href="https://readr.tidyverse.org">readr</a> para una carga r√°pida y eficaz de datos rectangulares (formatos <code>.csv</code>, <code>.tsv</code>, etc). Paquete <a href="https://readxl.tidyverse.org">readxl</a> para importar archivos <code>.xls</code> y <code>.xlsx</code>. Paquete <a href="https://haven.tidyverse.org">haven</a> para importar archivos desde SPSS, Stata y SAS. Paquete <a href="https://httr.r-lib.org/">httr</a> para importar desde web. Paquete <a href="https://rvest.tidyverse.org/">rvest</a> para <em>web scraping</em>.</p></li>
<li><p><a href="https://dplyr.tidyverse.org">dplyr</a>: una gram√°tica de manipulaci√≥n de datos para facilitar su procesamiento.</p></li>
<li><p><a href="https://ggplot2.tidyverse.org">ggplot2</a>: una gram√°tica para la visualizaci√≥n de datos.</p></li>
<li><p>Paquete <a href="http://stringr.tidyverse.org">stringr</a> para un manejo sencillo de cadenas de texto. Paquete <code>{forcast}</code> para un manejo de variables cualitativas (en <code>R</code> conocidas como factores). Paquete <a href="http://purrr.tidyverse.org">purrr</a> para el manejo de listas y una programaci√≥n funcional con las mismas. Paquete <a href="https://lubridate.tidyverse.org">lubridate</a> para el manejo de fechas.</p></li>
</ul>
<p>Puedes ver su <strong>documentaci√≥n completa</strong> en en <a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a>.</p>
<p>¬†</p>
<p>En este entorno, tendremos un <mark><strong>operador clave</strong></mark>: el operador <mark><strong>pipeline (%&gt;%)</strong></mark>. Dicho operador lo debemos interpretar como una <strong>flecha</strong> que une nodos, y nos servir√° para <mark><strong>concatenar operaciones</strong></mark> sobre un conjunto de datos de forma <mark><strong>legible</strong></mark>. Por ejemplo, si tuvi√©semos tres funciones <code><a href="https://rdrr.io/pkg/dplyr/man/nth.html">first()</a></code>, <code><a href="https://rdrr.io/pkg/lubridate/man/second.html">second()</a></code> y <code>third()</code>, la opci√≥n m√°s inmediata ser√≠a anidar las tres funciones.</p>
<div class="sourceCode" id="cb1367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">third</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lubridate/man/second.html">second</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/nth.html">first</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>El anidamiento es <strong>compacto</strong> pero dificulta la lectura posterior del c√≥digo: con el <strong>pipeline %&gt;%</strong> podremos escribir (y leer) la <mark><strong>concetanci√≥n de acciones de izquierda a derecha</strong></mark>:</p>
<div class="sourceCode" id="cb1368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/nth.html">first</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/lubridate/man/second.html">second</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">third</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<p>Dicho operador viene <strong>heredado</strong> del paquete <a href="https://magrittr.tidyverse.org">magrittr</a>, lo que hace que muchos paquetes de <a href="https://tidyverse.tidyverse.org">tidyverse</a> dependan de √©l. Para evitar esta dependencia (cuantos menos paquetes tengamos que cargar, mejor), desde la <mark><strong>versi√≥n 4.1.0 de R</strong></mark>, disponemos de un operador pipeline <strong>nativo</strong> de <code>R</code>, el <mark><strong>operador |&gt;</strong></mark> (disponible adem√°s fuera del entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a>. En este manual seguiremos usando el operador <code><a href="https://rdrr.io/pkg/tidyr/man/pipe.html">%&gt;%</a></code>, pero es muy probable que en cada vez m√°s c√≥digos que busques por la red observes <code>|&gt;</code> en detrimento de <code><a href="https://rdrr.io/pkg/tidyr/man/pipe.html">%&gt;%</a></code> (aunque el primero es m√°s r√°pido, m√°s eficiente y sin necesidad de cargar otros paquetes).</p>
</div>
<div id="messy-data-valores-en-columnas-en-lugar-de-variables" class="section level2">
<h2>
<span class="header-section-number">16.2</span> Messy data: valores en columnas en lugar de variables<a class="anchor" aria-label="anchor" href="#messy-data-valores-en-columnas-en-lugar-de-variables"><i class="fas fa-link"></i></a>
</h2>
<p>Vamos a visualizar la tabla <code>table4a</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a> (que ya lo tenemos cargado del entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a>).</p>
<div class="sourceCode" id="cb1369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 √ó 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<p>Si te fijas, tenemos una columna <code>country</code>, representando una variable con el nombre de los pa√≠ses, <strong>¬°pero las otras columnas no representan cada una a una sola variable!</strong> Ambas son la misma variable, solo que medida en a√±os distintos (que deber√≠a ser a su vez otra variable): <strong>cada fila est√° representando dos observaciones</strong> (1999, 2000) en lugar de un solo registro. Lo que haremos ser√° incluir una nueva columna llamada <code>year</code> que nos marque el a√±o y otra <code>values</code> que nos diga el valor de la variable de inter√©s en cada uno de esos a√±os.</p>
<p>Con la <mark><strong>funci√≥n <code>pivot_longer</code></strong></mark> del mencionada paquete le indicaremos lo siguiente:</p>
<ul>
<li>
<code>cols</code>: el nombre de las columnas que vamos a <strong>pivotar</strong> (con comillas porque son n√∫meros, no texto como nombre).</li>
<li>
<code>names_to</code>: el nombre de la columna a la que vamos a mandar los valores que figuran ahora en los nombres de las columnas.</li>
<li>
<code>values_to</code>: el nombre de la columna a la que vamos a mandar los valores.</li>
</ul>
<div class="sourceCode" id="cb1371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="va">table4a</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1999"</span>, <span class="st">"2000"</span><span class="op">)</span>,
                         names_to <span class="op">=</span> <span class="st">"year"</span>,
                         values_to <span class="op">=</span> <span class="st">"values"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 3
##   country     year  values
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Afghanistan 2000    2666
## 3 Brazil      1999   37737
## 4 Brazil      2000   80488
## 5 China       1999  212258
## 6 China       2000  213766</code></pre>
<p>Ahora tenemos un <strong>registro por fila, una variable por columna y cada celda representa un √∫nico valor</strong>. Este ejemplo de <em>messy data</em> lo podemos encontrar muy a menudo cuando <strong>construimos rangos de variables</strong> pensando que es mejor tener una tabla m√°s compacta (alargar la tabla a lo ancho en lugar de a lo largo). Es el caso de la tabla <code>relig_income</code>.</p>
<div class="sourceCode" id="cb1373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relig_income</span></code></pre></div>
<pre><code>## # A tibble: 18 √ó 11
##    religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
##    &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 Agnostic      27        34        60        81        76       137        122
##  2 Atheist       12        27        37        52        35        70         73
##  3 Buddhist      27        21        30        34        33        58         62
##  4 Catholic     418       617       732       670       638      1116        949
##  5 Don‚Äôt k‚Ä¶      15        14        15        11        10        35         21
##  6 Evangel‚Ä¶     575       869      1064       982       881      1486        949
##  7 Hindu          1         9         7         9        11        34         47
##  8 Histori‚Ä¶     228       244       236       238       197       223        131
##  9 Jehovah‚Ä¶      20        27        24        24        21        30         15
## 10 Jewish        19        19        25        25        30        95         69
## 11 Mainlin‚Ä¶     289       495       619       655       651      1107        939
## 12 Mormon        29        40        48        51        56       112         85
## 13 Muslim         6         7         9        10         9        23         16
## 14 Orthodox      13        17        23        32        32        47         38
## 15 Other C‚Ä¶       9         7        11        13        13        14         18
## 16 Other F‚Ä¶      20        33        40        46        49        63         46
## 17 Other W‚Ä¶       5         2         3         4         2         7          3
## 18 Unaffil‚Ä¶     217       299       374       365       341       528        407
## # ‚Ä¶ with 3 more variables: $100-150k &lt;dbl&gt;, &gt;150k &lt;dbl&gt;,
## #   Don't know/refused &lt;dbl&gt;</code></pre>
<p>Salvo la primera, el resto de columnas tienen como <strong>nombre los valores de una variable en s√≠ misma</strong> (ingresos). Para ordenar los datos vamos a razonar de la misma manera solo que ahora, en lugar de indicarle el nombre de todas las columnas que queremos usar de entrada, vamos a <strong>indicarle de forma m√°s corta la columna que NO queremos seleccionar</strong>.</p>
<div class="sourceCode" id="cb1375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># No necesitamos las comillas en el nombre de columnas salvo que tengan caracteres que no sean letras</span>
<span class="va">relig_income</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">religion</span>, names_to <span class="op">=</span> <span class="st">"ingresos"</span>,
                              values_to <span class="op">=</span> <span class="st">"frecuencia"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 180 √ó 3
##    religion ingresos           frecuencia
##    &lt;chr&gt;    &lt;chr&gt;                   &lt;dbl&gt;
##  1 Agnostic &lt;$10k                      27
##  2 Agnostic $10-20k                    34
##  3 Agnostic $20-30k                    60
##  4 Agnostic $30-40k                    81
##  5 Agnostic $40-50k                    76
##  6 Agnostic $50-75k                   137
##  7 Agnostic $75-100k                  122
##  8 Agnostic $100-150k                 109
##  9 Agnostic &gt;150k                      84
## 10 Agnostic Don't know/refused         96
## # ‚Ä¶ with 170 more rows</code></pre>
<p>Lo que hacemos con <code><a href="https://rdrr.io/pkg/tidyr/man/pivot_longer.html">pivot_longer()</a></code> es <strong>¬´ampliar¬ª la tabla, haci√©ndola m√°s larga (m√°s filas) pero con menos columnas</strong>.</p>
</div>
<div id="messy-data-una-observaci√≥n-guardada-en-varias-filas" class="section level2">
<h2>
<span class="header-section-number">16.3</span> Messy data: una observaci√≥n guardada en varias filas<a class="anchor" aria-label="anchor" href="#messy-data-una-observaci%C3%B3n-guardada-en-varias-filas"><i class="fas fa-link"></i></a>
</h2>
<p>Vamos a visualizar ahora la tabla <code>table2</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a>.</p>
<div class="sourceCode" id="cb1377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table2</span></code></pre></div>
<pre><code>## # A tibble: 12 √ó 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<p>F√≠jate en las cuatro primeras filas: los registros con el mismo a√±o deber√≠an ser el mismo, es la misma informaci√≥n, deber√≠a estar en la misma fila, pero est√° dividada en dos. Por un lado una fila para la variable <code>cases</code> y otra para <code>population</code>. Lo que haremos ser√° lo opuesto a antes: con <code><a href="https://rdrr.io/pkg/tidyr/man/pivot_wider.html">pivot_wider()</a></code> <strong>¬´ampliaremos¬ª la tabla a lo ancho, haci√©ndola menos (menos filas) pero con m√°s columnas</strong>.</p>
<ul>
<li>
<code>names_from</code>: el nombre de la columna de la que vamos a sacar las nuevas columnas que vamos a crear (<code>cases</code> y <code>population</code>).</li>
<li>
<code>values_from</code>: el nombre de la columna de la que vamos a sacar los valores.</li>
</ul>
<div class="sourceCode" id="cb1379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">type</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Ahora tenemos <strong>cada registro en una fila</strong>, que nos indica pa√≠s-a√±o-casos-poblaci√≥n.</p>
</div>
<div id="messy-data-una-celda-con-m√∫ltiples-valores" class="section level2">
<h2>
<span class="header-section-number">16.4</span> Messy data: una celda con m√∫ltiples valores<a class="anchor" aria-label="anchor" href="#messy-data-una-celda-con-m%C3%BAltiples-valores"><i class="fas fa-link"></i></a>
</h2>
<p>Por √∫ltimo vamos a visualizar la tabla <code>table3</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a>.</p>
<div class="sourceCode" id="cb1381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<p>En la variable <code>rate</code> hay guardados dos valores, separados por <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code>, lo que hace que en <strong>una celda no tiene un √∫nico valor sino dos</strong>. La funci√≥n <code><a href="https://rdrr.io/pkg/tidyr/man/separate.html">separate()</a></code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a> nos permitir√° <mark><strong>separar los m√∫ltiples valores de la columna</strong></mark><code>rate</code> simplemente indic√°ndole el nombre de las nuevas columnas en el argumento <code>into = ...</code>, creando una nueva columna para cada uno de ellos.</p>
<div class="sourceCode" id="cb1383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Por defecto lo que hace es <strong>localizar como separador cualquier caracter que no sea alfa-num√©rico</strong>. Si queremos un caracter concreto para dividir podemos indic√°rselo expl√≠citamente</p>
<div class="sourceCode" id="cb1385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Si <strong>usas un separador que no est√° en los datos</strong> te devolver√° dichas columnas vac√≠as ya que no ha podido dividirlas.</p>
<div class="sourceCode" id="cb1387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 6 rows [1, 2, 3, 4,
## 5, 6].</code></pre>
<pre><code>## # A tibble: 6 √ó 4
##   country      year cases population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     
## 1 Afghanistan  1999 ""    ""        
## 2 Afghanistan  2000 ""    ""        
## 3 Brazil       1999 ""    ""        
## 4 Brazil       2000 ""    ""        
## 5 China        1999 ""    ""        
## 6 China        2000 ""    ""</code></pre>
<p>De la misma manera que podemos separar columnas <mark><strong>tambi√©n podemos unirlas</strong></mark>. Para ello vamos a usar la tabla <code>table5</code> del ya mencionado paquete. Con la funci√≥n <code><a href="https://rdrr.io/pkg/tidyr/man/unite.html">unite()</a></code> vamos a unir el siglo (en <code>century</code>) y el a√±o (en <code>year</code>), y al inicio le indicaremos como se llamar√° la nueva variable (<code>a√±o_completo</code>).</p>
<div class="sourceCode" id="cb1390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/unite.html">unite</a></span><span class="op">(</span><span class="va">a√±o_completo</span>, <span class="va">century</span>, <span class="va">year</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 3
##   country     a√±o_completo rate             
##   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;            
## 1 Afghanistan 19_99        745/19987071     
## 2 Afghanistan 20_00        2666/20595360    
## 3 Brazil      19_99        37737/172006362  
## 4 Brazil      20_00        80488/174504898  
## 5 China       19_99        212258/1272915272
## 6 China       20_00        213766/1280428583</code></pre>
<p>Como pasaba en <code><a href="https://rdrr.io/pkg/tidyr/man/separate.html">separate()</a></code>, tiene un argumento de separador por defecto, en este caso <code>sep = "_"</code>. <strong>Si queremos cambiarlo podemos hacerlo indic√°ndoselo expl√≠citamente</strong>.</p>
<div class="sourceCode" id="cb1392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/unite.html">unite</a></span><span class="op">(</span><span class="va">a√±o_completo</span>, <span class="va">century</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 3
##   country     a√±o_completo rate             
##   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;            
## 1 Afghanistan 1999         745/19987071     
## 2 Afghanistan 2000         2666/20595360    
## 3 Brazil      1999         37737/172006362  
## 4 Brazil      2000         80488/174504898  
## 5 China       1999         212258/1272915272
## 6 China       2000         213766/1280428583</code></pre>
</div>
<div id="consejos-10" class="section level2">
<h2>
<span class="header-section-number">16.5</span> Consejos<a class="anchor" aria-label="anchor" href="#consejos-10"><i class="fas fa-link"></i></a>
</h2>
<p><strong><span style="color: #20935E;">CONSEJOS</span></strong></p>
<p>¬†</p>
<p><strong><span style="color: #20935E;">Convertir variables al procesar</span></strong></p>
<p>Una opci√≥n muy √∫til que podemos usar al aplicar la separaci√≥n de los m√∫ltiples valores es <mark><strong>convertir los datos al tipo adecuado</strong></mark>. Los datos unidos en <code>rate</code> eran caracteres ya que ten√≠a el separador <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code> (no pod√≠an ser num√©ricos). Al separarlos, por defecto, aunque ahora ya son solo n√∫meros, los separa como si fueran textos. Con <code>convert = TRUE</code> podemos indicarle que identifique el tipo de dato y lo convierta (f√≠jate en la cabecera de las columnas ahora).</p>
<div class="sourceCode" id="cb1394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Dicha funci√≥n tambi√©n puede ser usada para <strong>dividir cifras, como por ejemplo el a√±o</strong></p>
<div class="sourceCode" id="cb1396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/separate.html">separate</a></span><span class="op">(</span><span class="va">year</span>,
                    into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"siglo"</span>, <span class="st">"a√±o"</span><span class="op">)</span>,
                    sep <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 4
##   country     siglo a√±o   rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 19    99    745/19987071     
## 2 Afghanistan 20    00    2666/20595360    
## 3 Brazil      19    99    37737/172006362  
## 4 Brazil      20    00    80488/174504898  
## 5 China       19    99    212258/1272915272
## 6 China       20    00    213766/1280428583</code></pre>
</div>
<div id="ejercicios-10" class="section level2">
<h2>
<span class="header-section-number">16.6</span> üìù Ejercicios<a class="anchor" aria-label="anchor" href="#ejercicios-10"><i class="fas fa-link"></i></a>
</h2>
<p>(haz click en las flechas para ver soluciones)</p>
<details><p><summary>üìù<strong>Ejercicio 1</strong>: convierte en <em>tidy data</em> el siguiente <code>data.frame</code>.</summary></p>
<div class="sourceCode" id="cb1398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">"trimestre"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="st">"T2"</span>, <span class="st">"T3"</span><span class="op">)</span>,
                   <span class="st">"2020"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">7.5</span><span class="op">)</span>,
                   <span class="st">"2021"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- toc -->
<ul>
<li>Soluci√≥n:</li>
</ul>
<p>El problema es que las dos columnas con nombres de a√±o son en realidad valores que deber√≠an pasar a ser variables, as√≠ que deber√≠amos disminuir aplicar <code><a href="https://rdrr.io/pkg/tidyr/man/pivot_longer.html">pivot_longer()</a></code></p>
<div class="sourceCode" id="cb1399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aplicamos pivot_longer</span>
<span class="va">tabla_tb</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020"</span>, <span class="st">"2021"</span><span class="op">)</span>,
                          names_to <span class="op">=</span> <span class="st">"a√±o"</span>, values_to <span class="op">=</span> <span class="st">"valores"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 3
##   trimestre a√±o   valores
##   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;
## 1 T1        2020     10  
## 2 T1        2021      8  
## 3 T2        2020     12  
## 4 T2        2021      0  
## 5 T3        2020      7.5
## 6 T3        2021      9</code></pre>
<!-- tocstop -->
</details><p>¬†</p>
<details><p><summary>üìù<strong>Ejercicio 2</strong>: convierte en <em>tidy data</em> el siguiente <code>data.frame</code>.</summary></p>
<div class="sourceCode" id="cb1401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">"a√±o"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2019</span>, <span class="fl">2020</span>, <span class="fl">2020</span>, <span class="fl">2021</span>, <span class="fl">2021</span><span class="op">)</span>,
                   <span class="st">"variable"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,
                   <span class="st">"valor"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9383</span>, <span class="fl">7.58</span>, <span class="fl">10839</span>, <span class="fl">9</span>, <span class="fl">32949</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- toc -->
<ul>
<li>Soluci√≥n:</li>
</ul>
<p>El problema es que las filas que comparten a√±o son el mismo registro (pero con dos caracter√≠sticas que tenemos divididas en dos filas), as√≠ que deber√≠amos disminuir aplicar <code><a href="https://rdrr.io/pkg/tidyr/man/pivot_wider.html">pivot_wider()</a></code></p>
<div class="sourceCode" id="cb1402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aplicamos pivot_wider</span>
<span class="va">tabla_tb</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"variable"</span>, values_from <span class="op">=</span> <span class="st">"valor"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 √ó 3
##     a√±o     A     B
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2019 10     9383
## 2  2020  7.58 10839
## 3  2021  9    32949</code></pre>
<!-- tocstop -->
</details><p>¬†</p>
<details><p><summary>üìù<strong>Ejercicio 3</strong>: convierte en <em>tidy data</em> la tabla <code>table5</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a>.</summary></p>
<!-- toc -->
<ul>
<li>Soluci√≥n:</li>
</ul>
<p>Primero uniremos el siglo y las dos √∫ltimas cifras del a√±o para obtener el a√±o completo (guardado en <code>a√±o</code>)</p>
<div class="sourceCode" id="cb1404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/unite.html">unite</a></span><span class="op">(</span><span class="va">a√±o</span>, <span class="va">century</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 3
##   country     a√±o   rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 1999  745/19987071     
## 2 Afghanistan 2000  2666/20595360    
## 3 Brazil      1999  37737/172006362  
## 4 Brazil      2000  80488/174504898  
## 5 China       1999  212258/1272915272
## 6 China       2000  213766/1280428583</code></pre>
<p>Tras ello deberemos separar el valor del ratio en denominador y numerador (ya que ahora hay dos valores en una celda), y convertiremos el tipo de dato en la salida para que sea n√∫mero.</p>
<div class="sourceCode" id="cb1406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/unite.html">unite</a></span><span class="op">(</span><span class="va">a√±o</span>, <span class="va">century</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"numerador"</span>, <span class="st">"denominador"</span><span class="op">)</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 √ó 4
##   country     a√±o   numerador denominador
##   &lt;chr&gt;       &lt;chr&gt;     &lt;int&gt;       &lt;int&gt;
## 1 Afghanistan 1999        745    19987071
## 2 Afghanistan 2000       2666    20595360
## 3 Brazil      1999      37737   172006362
## 4 Brazil      2000      80488   174504898
## 5 China       1999     212258  1272915272
## 6 China       2000     213766  1280428583</code></pre>
<!-- tocstop -->
</details>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tibble.html"><span class="header-section-number">15</span> Mejorando los data.frame: datos tibble</a></div>
<div class="next"><a href="importar-exportar.html"><span class="header-section-number">17</span> Sacando datos de las piedras</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidy"><span class="header-section-number">16</span> Tidy vs messy data: daticos ordenados</a></li>
<li><a class="nav-link" href="#entorno-tidyverse"><span class="header-section-number">16.1</span> Entorno tidyverse</a></li>
<li><a class="nav-link" href="#messy-data-valores-en-columnas-en-lugar-de-variables"><span class="header-section-number">16.2</span> Messy data: valores en columnas en lugar de variables</a></li>
<li><a class="nav-link" href="#messy-data-una-observaci%C3%B3n-guardada-en-varias-filas"><span class="header-section-number">16.3</span> Messy data: una observaci√≥n guardada en varias filas</a></li>
<li><a class="nav-link" href="#messy-data-una-celda-con-m%C3%BAltiples-valores"><span class="header-section-number">16.4</span> Messy data: una celda con m√∫ltiples valores</a></li>
<li><a class="nav-link" href="#consejos-10"><span class="header-section-number">16.5</span> Consejos</a></li>
<li><a class="nav-link" href="#ejercicios-10"><span class="header-section-number">16.6</span> üìù Ejercicios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/dadosdelaplace/courses-ECI-2022/blob/master/16-tidy.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/dadosdelaplace/courses-ECI-2022/edit/master/16-tidy.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analizando datos, visualizando informaci√≥n, contando historias</strong>" was written by Javier √Ålvarez Li√©bana y Gabriel Valverde Castilla. It was last built on √öltima actualizaci√≥n: 22-01-2022.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
